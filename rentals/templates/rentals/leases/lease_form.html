{% extends "rentals/base.html" %}

{% block title %}{% if object %}Update Lease{% else %}Create Lease{% endif %}{% endblock %}

{% block extra_css %}
<style>
    .lease-form {
        max-width: 1000px;
        margin: 0 auto;
    }
    .form-group {
        margin-bottom: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header bg-primary text-white">
        <h2>{% if object %}Update Lease Contract{% else %}Create New Lease Contract{% endif %}</h2>
    </div>
    <div class="card-body">
        <form method="post" enctype="multipart/form-data" class="lease-form">
            {% csrf_token %}
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="{{ form.property.id_for_label }}" class="form-label">Property</label>
                        {{ form.property }}
                    </div>
                    <div class="mb-3">
                        <label for="{{ form.tenant.id_for_label }}" class="form-label">Tenant</label>
                        {{ form.tenant }}
                    </div>
                    <div class="mb-3">
                        <label for="{{ form.lease_type.id_for_label }}" class="form-label">Lease Type</label>
                        {{ form.lease_type }}
                    </div>
                    <div class="mb-3">
                        <label for="{{ form.start_date.id_for_label }}" class="form-label">Start Date</label>
                        {{ form.start_date }}
                    </div>
                    <div class="mb-3">
                        <label for="{{ form.end_date.id_for_label }}" class="form-label">End Date</label>
                        {{ form.end_date }}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3" id="solidarity-clause-group" style="{% if form.lease_type.value != 'colocation' %}display: none;{% endif %}">
                        <label for="{{ form.has_solidarity_clause.id_for_label }}" class="form-label">Solidarity Clause</label>
                        {{ form.has_solidarity_clause }}
                        <div class="form-text">For colocations: if checked, all tenants are jointly liable.</div>
                    </div>
                    <div class="mb-3">
                        <label for="{{ form.flat_rate_charges.id_for_label }}" class="form-label">Flat Rate Charges ($)</label>
                        {{ form.flat_rate_charges }}
                        <div class="form-text">Used when individual consumption cannot be measured.</div>
                    </div>
                    <div class="mb-3">
                        <label for="{{ form.deposit_amount.id_for_label }}" class="form-label">Deposit Amount ($)</label>
                        {{ form.deposit_amount }}
                    </div>
                    <div class="mb-3">
                        <label for="{{ form.status.id_for_label }}" class="form-label">Status</label>
                        {{ form.status }}
                    </div>
                    <div class="mb-3">
                        <label for="{{ form.contract_document.id_for_label }}" class="form-label">Contract Document</label>
                        {{ form.contract_document }}
                        <div class="form-text">Upload the signed lease contract (PDF).</div>
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <label for="{{ form.notes.id_for_label }}" class="form-label">Notes</label>
                {{ form.notes }}
            </div>
            <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                <button type="submit" class="btn btn-primary me-md-2">
                    <i class="bi bi-save"></i> Save
                </button>
                <a href="{% if object %}{% url 'rentals:leases_detail' object.pk %}{% else %}{% url 'rentals:leases_list' %}{% endif %}" class="btn btn-secondary">
                    <i class="bi bi-x-circle"></i> Cancel
                </a>
            </div>
        </form>
    </div>
</div>

{% block extra_js %}
<script>
    // Show/hide solidarity clause based on lease type
    document.addEventListener('DOMContentLoaded', function() {
        const leaseTypeSelect = document.getElementById('{{ form.lease_type.id_for_label }}');
        const solidarityGroup = document.getElementById('solidarity-clause-group');

        function updateSolidarityClauseVisibility() {
            if (leaseTypeSelect.value === 'colocation') {
                solidarityGroup.style.display = 'block';
            } else {
                solidarityGroup.style.display = 'none';
            }
        }

        leaseTypeSelect.addEventListener('change', updateSolidarityClauseVisibility);
        updateSolidarityClauseVisibility();  // Initial check
    });
</script>
{% endblock %}
{% endblock %}
